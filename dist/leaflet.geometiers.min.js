function number_format(a,b,c,d){a=(a+"").replace(",","").replace(" ","");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g="undefined"==typeof d?",":d,h="undefined"==typeof c?".":c,i="",j=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c};return i=(f?j(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)}function format(a){var a=a.toString(),a=a.replace(".",",");return""!=a.charAt(3)&&(a=a.slice(0,a.length-3)+" "+a.slice(a.length-3,a.length)),a}!function(){function a(){var a={},b=[];return a.data=function(c){return arguments.length?(b=c.slice(),a):b},a.mb=function(){var a,c,d=b.length;if(1===d)a=0,c=b[0][1];else{for(var e,f,g,h=0,i=0,j=0,k=0,l=0;l<d;l++)e=b[l],f=e[0],g=e[1],h+=f,i+=g,j+=f*f,k+=f*g;a=(d*k-h*i)/(d*j-h*h),c=i/d-a*h/d}return{m:a,b:c}},a.m=function(){return a.mb().m},a.b=function(){return a.mb().b},a.line=function(){var b=a.mb(),c=b.m,d=b.b;return function(a){return d+c*a}},a}function b(a,b){if(a.length<2)return 1;for(var c,d=0,e=0;e<a.length;e++)d+=a[e][1];c=d/a.length;for(var f=0,g=0;g<a.length;g++)f+=Math.pow(c-a[g][1],2);for(var h=0,i=0;i<a.length;i++)h+=Math.pow(a[i][1]-b(a[i][0]),2);return 1-h/f}function c(){var a={},b=0,c={};return a.train=function(a,d){c[d]||(c[d]={});for(var e in a){var f=a[e];void 0===c[d][e]&&(c[d][e]={}),void 0===c[d][e][f]&&(c[d][e][f]=0),c[d][e][a[e]]++}b++},a.score=function(a){var d,e={};for(var f in a){var g=a[f];for(d in c)void 0===e[d]&&(e[d]={}),c[d][f]?e[d][f+"_"+g]=(c[d][f][g]||0)/b:e[d][f+"_"+g]=0}var h={};for(d in e)for(var i in e[d])void 0===h[d]&&(h[d]=0),h[d]+=e[d][i];return h},a}function d(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b}function e(a){return 0===a.length?null:d(a)/a.length}function f(a){if(0===a.length)return null;for(var b=1,c=0;c<a.length;c++){if(a[c]<=0)return null;b*=a[c]}return Math.pow(b,1/a.length)}function g(a){if(0===a.length)return null;for(var b=0,c=0;c<a.length;c++){if(a[c]<=0)return null;b+=1/a[c]}return a.length/b}function h(a){if(0===a.length)return null;for(var b=0,c=0;c<a.length;c++)b+=Math.pow(a[c],2);return Math.sqrt(b/a.length)}function i(a){for(var b,c=0;c<a.length;c++)(a[c]<b||void 0===b)&&(b=a[c]);return b}function j(a){for(var b,c=0;c<a.length;c++)(a[c]>b||void 0===b)&&(b=a[c]);return b}function k(a){if(0===a.length)return null;for(var b=e(a),c=[],d=0;d<a.length;d++)c.push(Math.pow(a[d]-b,2));return e(c)}function l(a){return 0===a.length?null:Math.sqrt(k(a))}function m(a,b){for(var c=e(a),d=0,f=0;f<a.length;f++)d+=Math.pow(a[f]-c,b);return d}function n(a){if(a.length<=1)return null;var b=m(a,2);return b/(a.length-1)}function o(a){return a.length<=1?null:Math.sqrt(n(a))}function p(a,b){if(a.length<=1||a.length!=b.length)return null;for(var c=e(a),d=e(b),f=0,g=0;g<a.length;g++)f+=(a[g]-c)*(b[g]-d);return f/(a.length-1)}function q(a,b){var c=p(a,b),d=o(a),e=o(b);return null===c||null===d||null===e?null:c/d/e}function r(a){if(0===a.length)return null;var b=a.slice().sort(function(a,b){return a-b});if(b.length%2===1)return b[(b.length-1)/2];var c=b[b.length/2-1],d=b[b.length/2];return(c+d)/2}function s(a){if(0===a.length)return null;if(1===a.length)return a[0];for(var b,c=a.slice().sort(function(a,b){return a-b}),d=c[0],e=0,f=1,g=1;g<c.length+1;g++)c[g]!==d?(f>e&&(e=f,b=d),f=1,d=c[g]):f++;return b}function t(a,b){var c=e(a),d=l(a),f=Math.sqrt(a.length);return(c-b)/(d/f)}function u(a,b,c){var d=a.length,f=b.length;if(!d||!f)return null;c||(c=0);var g=e(a),h=e(b),i=((d-1)*n(a)+(f-1)*n(b))/(d+f-2);return(g-h-c)/Math.sqrt(i*(1/d+1/f))}function v(a,b){var c=[];if(b<=0)return null;for(var d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c}function w(a,b){b=b||Math.random;for(var c,d,e=a.length;e>0;)d=Math.floor(b()*e--),c=a[e],a[e]=a[d],a[d]=c;return a}function x(a,b){return a=a.slice(),w(a.slice(),b)}function y(a,b,c){var d=x(a,c);return d.slice(0,b)}function z(a,b){if(0===a.length)return null;var c=a.slice().sort(function(a,b){return a-b});if(b.length){for(var d=[],e=0;e<b.length;e++)d[e]=A(c,b[e]);return d}return A(c,b)}function A(a,b){var c=a.length*b;return b<0||b>1?null:1===b?a[a.length-1]:0===b?a[0]:c%1!==0?a[Math.ceil(c)-1]:a.length%2===0?(a[c-1]+a[c])/2:a[c]}function B(a){return 0===a.length?null:z(a,.75)-z(a,.25)}function C(a){if(!a||0===a.length)return null;for(var b=r(a),c=[],d=0;d<a.length;d++)c.push(Math.abs(a[d]-b));return r(c)}function D(a,b){var c,d,e=[],f=[],g=0;for(c=0;c<a.length+1;c++){var h=[],i=[];for(d=0;d<b+1;d++)h.push(0),i.push(0);e.push(h),f.push(i)}for(c=1;c<b+1;c++)for(e[1][c]=1,f[1][c]=0,d=2;d<a.length+1;d++)f[d][c]=1/0;for(var j=2;j<a.length+1;j++){for(var k=0,l=0,m=0,n=0,o=1;o<j+1;o++){var p=j-o+1,q=a[p-1];if(m++,k+=q,l+=q*q,g=l-k*k/m,n=p-1,0!==n)for(d=2;d<b+1;d++)f[j][d]>=g+f[n][d-1]&&(e[j][d]=p,f[j][d]=g+f[n][d-1])}e[j][1]=1,f[j][1]=g}return{lower_class_limits:e,variance_combinations:f}}function E(a,b,c){var d=a.length-1,e=[],f=c;for(e[c]=a[a.length-1],e[0]=a[0];f>1;)e[f-1]=a[b[d][f]-2],d=b[d][f]-1,f--;return e}function F(a,b){if(b>a.length)return null;a=a.slice().sort(function(a,b){return a-b});var c=D(a,b),d=c.lower_class_limits;return E(a,d,b)}function G(a){if(a.length<3)return null;var b=a.length,c=Math.pow(o(a),3),d=m(a,3);return b*d/((b-1)*(b-2)*c)}function H(a){var b=Math.abs(a),c=Math.floor(10*b),d=10*(Math.floor(100*b)/10-Math.floor(100*b/10)),e=Math.min(10*c+d,Q.length-1);return a>=0?Q[e]:+(1-Q[e]).toFixed(4)}function I(a,b,c){return(a-b)/c}function J(a){if(a<0)return null;for(var b=1,c=2;c<=a;c++)b*=c;return b}function K(a){return a<0||a>1?null:L(1,a)}function L(a,b){function c(a,b,c){return J(b)/(J(a)*J(b-a))*(Math.pow(c,a)*Math.pow(1-c,b-a))}if(b<0||b>1||a<=0||a%1!==0)return null;var d=0,e=0,f={};do f[d]=c(d,a,b),e+=f[d],d++;while(e<1-R);return f}function M(a){function b(a,b){return Math.pow(Math.E,-b)*Math.pow(b,a)/J(a)}if(a<=0)return null;var c=0,d=0,e={};do e[c]=b(c,a),d+=e[c],c++;while(d<1-R);return e}function N(a,b,c){for(var d,f,g=e(a),h=0,i=1,j=b(g),k=[],l=[],m=0;m<a.length;m++)void 0===k[a[m]]&&(k[a[m]]=0),k[a[m]]++;for(m=0;m<k.length;m++)void 0===k[m]&&(k[m]=0);for(f in j)f in k&&(l[f]=j[f]*a.length);for(f=l.length-1;f>=0;f--)l[f]<3&&(l[f-1]+=l[f],l.pop(),k[f-1]+=k[f],k.pop());for(f=0;f<k.length;f++)h+=Math.pow(k[f]-l[f],2)/l[f];return d=k.length-i-1,S[d][c]<h}function O(a){function b(a){return function(){var b=Array.prototype.slice.apply(arguments);return b.unshift(this),P[a].apply(P,b)}}var c=!(!Object.defineProperty||!Object.defineProperties);if(!c)throw new Error("without defineProperty, simple-statistics cannot be mixed in");var d,e=["median","standard_deviation","sum","sample_skewness","mean","min","max","quantile","geometric_mean","harmonic_mean","root_mean_square"];d=a?a.slice():Array.prototype;for(var f=0;f<e.length;f++)Object.defineProperty(d,e[f],{value:b(e[f]),configurable:!0,enumerable:!1,writable:!0});return d}var P={};"undefined"!=typeof module?module.exports=P:this.ss=P;var Q=[.5,.504,.508,.512,.516,.5199,.5239,.5279,.5319,.5359,.5398,.5438,.5478,.5517,.5557,.5596,.5636,.5675,.5714,.5753,.5793,.5832,.5871,.591,.5948,.5987,.6026,.6064,.6103,.6141,.6179,.6217,.6255,.6293,.6331,.6368,.6406,.6443,.648,.6517,.6554,.6591,.6628,.6664,.67,.6736,.6772,.6808,.6844,.6879,.6915,.695,.6985,.7019,.7054,.7088,.7123,.7157,.719,.7224,.7257,.7291,.7324,.7357,.7389,.7422,.7454,.7486,.7517,.7549,.758,.7611,.7642,.7673,.7704,.7734,.7764,.7794,.7823,.7852,.7881,.791,.7939,.7967,.7995,.8023,.8051,.8078,.8106,.8133,.8159,.8186,.8212,.8238,.8264,.8289,.8315,.834,.8365,.8389,.8413,.8438,.8461,.8485,.8508,.8531,.8554,.8577,.8599,.8621,.8643,.8665,.8686,.8708,.8729,.8749,.877,.879,.881,.883,.8849,.8869,.8888,.8907,.8925,.8944,.8962,.898,.8997,.9015,.9032,.9049,.9066,.9082,.9099,.9115,.9131,.9147,.9162,.9177,.9192,.9207,.9222,.9236,.9251,.9265,.9279,.9292,.9306,.9319,.9332,.9345,.9357,.937,.9382,.9394,.9406,.9418,.9429,.9441,.9452,.9463,.9474,.9484,.9495,.9505,.9515,.9525,.9535,.9545,.9554,.9564,.9573,.9582,.9591,.9599,.9608,.9616,.9625,.9633,.9641,.9649,.9656,.9664,.9671,.9678,.9686,.9693,.9699,.9706,.9713,.9719,.9726,.9732,.9738,.9744,.975,.9756,.9761,.9767,.9772,.9778,.9783,.9788,.9793,.9798,.9803,.9808,.9812,.9817,.9821,.9826,.983,.9834,.9838,.9842,.9846,.985,.9854,.9857,.9861,.9864,.9868,.9871,.9875,.9878,.9881,.9884,.9887,.989,.9893,.9896,.9898,.9901,.9904,.9906,.9909,.9911,.9913,.9916,.9918,.992,.9922,.9925,.9927,.9929,.9931,.9932,.9934,.9936,.9938,.994,.9941,.9943,.9945,.9946,.9948,.9949,.9951,.9952,.9953,.9955,.9956,.9957,.9959,.996,.9961,.9962,.9963,.9964,.9965,.9966,.9967,.9968,.9969,.997,.9971,.9972,.9973,.9974,.9974,.9975,.9976,.9977,.9977,.9978,.9979,.9979,.998,.9981,.9981,.9982,.9982,.9983,.9984,.9984,.9985,.9985,.9986,.9986,.9987,.9987,.9987,.9988,.9988,.9989,.9989,.9989,.999,.999],R=1e-4,S={1:{.995:0,.99:0,.975:0,.95:0,.9:.02,.5:.45,.1:2.71,.05:3.84,.025:5.02,.01:6.63,.005:7.88},2:{.995:.01,.99:.02,.975:.05,.95:.1,.9:.21,.5:1.39,.1:4.61,.05:5.99,.025:7.38,.01:9.21,.005:10.6},3:{.995:.07,.99:.11,.975:.22,.95:.35,.9:.58,.5:2.37,.1:6.25,.05:7.81,.025:9.35,.01:11.34,.005:12.84},4:{.995:.21,.99:.3,.975:.48,.95:.71,.9:1.06,.5:3.36,.1:7.78,.05:9.49,.025:11.14,.01:13.28,.005:14.86},5:{.995:.41,.99:.55,.975:.83,.95:1.15,.9:1.61,.5:4.35,.1:9.24,.05:11.07,.025:12.83,.01:15.09,.005:16.75},6:{.995:.68,.99:.87,.975:1.24,.95:1.64,.9:2.2,.5:5.35,.1:10.65,.05:12.59,.025:14.45,.01:16.81,.005:18.55},7:{.995:.99,.99:1.25,.975:1.69,.95:2.17,.9:2.83,.5:6.35,.1:12.02,.05:14.07,.025:16.01,.01:18.48,.005:20.28},8:{.995:1.34,.99:1.65,.975:2.18,.95:2.73,.9:3.49,.5:7.34,.1:13.36,.05:15.51,.025:17.53,.01:20.09,.005:21.96},9:{.995:1.73,.99:2.09,.975:2.7,.95:3.33,.9:4.17,.5:8.34,.1:14.68,.05:16.92,.025:19.02,.01:21.67,.005:23.59},10:{.995:2.16,.99:2.56,.975:3.25,.95:3.94,.9:4.87,.5:9.34,.1:15.99,.05:18.31,.025:20.48,.01:23.21,.005:25.19},11:{.995:2.6,.99:3.05,.975:3.82,.95:4.57,.9:5.58,.5:10.34,.1:17.28,.05:19.68,.025:21.92,.01:24.72,.005:26.76},12:{.995:3.07,.99:3.57,.975:4.4,.95:5.23,.9:6.3,.5:11.34,.1:18.55,.05:21.03,.025:23.34,.01:26.22,.005:28.3},13:{.995:3.57,.99:4.11,.975:5.01,.95:5.89,.9:7.04,.5:12.34,.1:19.81,.05:22.36,.025:24.74,.01:27.69,.005:29.82},14:{.995:4.07,.99:4.66,.975:5.63,.95:6.57,.9:7.79,.5:13.34,.1:21.06,.05:23.68,.025:26.12,.01:29.14,.005:31.32},15:{.995:4.6,.99:5.23,.975:6.27,.95:7.26,.9:8.55,.5:14.34,.1:22.31,.05:25,.025:27.49,.01:30.58,.005:32.8},16:{.995:5.14,.99:5.81,.975:6.91,.95:7.96,.9:9.31,.5:15.34,.1:23.54,.05:26.3,.025:28.85,.01:32,.005:34.27},17:{.995:5.7,.99:6.41,.975:7.56,.95:8.67,.9:10.09,.5:16.34,.1:24.77,.05:27.59,.025:30.19,.01:33.41,.005:35.72},18:{.995:6.26,.99:7.01,.975:8.23,.95:9.39,.9:10.87,.5:17.34,.1:25.99,.05:28.87,.025:31.53,.01:34.81,.005:37.16},19:{.995:6.84,.99:7.63,.975:8.91,.95:10.12,.9:11.65,.5:18.34,.1:27.2,.05:30.14,.025:32.85,.01:36.19,.005:38.58},20:{.995:7.43,.99:8.26,.975:9.59,.95:10.85,.9:12.44,.5:19.34,.1:28.41,.05:31.41,.025:34.17,.01:37.57,.005:40},21:{.995:8.03,.99:8.9,.975:10.28,.95:11.59,.9:13.24,.5:20.34,.1:29.62,.05:32.67,.025:35.48,.01:38.93,.005:41.4},22:{.995:8.64,.99:9.54,.975:10.98,.95:12.34,.9:14.04,.5:21.34,.1:30.81,.05:33.92,.025:36.78,.01:40.29,.005:42.8},23:{.995:9.26,.99:10.2,.975:11.69,.95:13.09,.9:14.85,.5:22.34,.1:32.01,.05:35.17,.025:38.08,.01:41.64,.005:44.18},24:{.995:9.89,.99:10.86,.975:12.4,.95:13.85,.9:15.66,.5:23.34,.1:33.2,.05:36.42,.025:39.36,.01:42.98,.005:45.56},25:{.995:10.52,.99:11.52,.975:13.12,.95:14.61,.9:16.47,.5:24.34,.1:34.28,.05:37.65,.025:40.65,.01:44.31,.005:46.93},26:{.995:11.16,.99:12.2,.975:13.84,.95:15.38,.9:17.29,.5:25.34,.1:35.56,.05:38.89,.025:41.92,.01:45.64,.005:48.29},27:{.995:11.81,.99:12.88,.975:14.57,.95:16.15,.9:18.11,.5:26.34,.1:36.74,.05:40.11,.025:43.19,.01:46.96,.005:49.65},28:{.995:12.46,.99:13.57,.975:15.31,.95:16.93,.9:18.94,.5:27.34,.1:37.92,.05:41.34,.025:44.46,.01:48.28,.005:50.99},29:{.995:13.12,.99:14.26,.975:16.05,.95:17.71,.9:19.77,.5:28.34,.1:39.09,.05:42.56,.025:45.72,.01:49.59,.005:52.34},30:{.995:13.79,.99:14.95,.975:16.79,.95:18.49,.9:20.6,.5:29.34,.1:40.26,.05:43.77,.025:46.98,.01:50.89,.005:53.67},40:{.995:20.71,.99:22.16,.975:24.43,.95:26.51,.9:29.05,.5:39.34,.1:51.81,.05:55.76,.025:59.34,.01:63.69,.005:66.77},50:{.995:27.99,.99:29.71,.975:32.36,.95:34.76,.9:37.69,.5:49.33,.1:63.17,.05:67.5,.025:71.42,.01:76.15,.005:79.49},60:{.995:35.53,.99:37.48,.975:40.48,.95:43.19,.9:46.46,.5:59.33,.1:74.4,.05:79.08,.025:83.3,.01:88.38,.005:91.95},70:{.995:43.28,.99:45.44,.975:48.76,.95:51.74,.9:55.33,.5:69.33,.1:85.53,.05:90.53,.025:95.02,.01:100.42,.005:104.22},80:{.995:51.17,.99:53.54,.975:57.15,.95:60.39,.9:64.28,.5:79.33,.1:96.58,.05:101.88,.025:106.63,.01:112.33,.005:116.32},90:{.995:59.2,.99:61.75,.975:65.65,.95:69.13,.9:73.29,.5:89.33,.1:107.57,.05:113.14,.025:118.14,.01:124.12,.005:128.3},100:{.995:67.33,.99:70.06,.975:74.22,.95:77.93,.9:82.36,.5:99.33,.1:118.5,.05:124.34,.025:129.56,.01:135.81,.005:140.17}};P.linear_regression=a,P.standard_deviation=l,P.r_squared=b,P.median=r,P.mean=e,P.mode=s,P.min=i,P.max=j,P.sum=d,P.quantile=z,P.quantile_sorted=A,P.iqr=B,P.mad=C,P.chunk=v,P.shuffle=x,P.shuffle_in_place=w,P.sample=y,P.sample_covariance=p,P.sample_correlation=q,P.sample_variance=n,P.sample_standard_deviation=o,P.sample_skewness=G,P.geometric_mean=f,P.harmonic_mean=g,P.root_mean_square=h,P.variance=k,P.t_test=t,P.t_test_two_sample=u,P.jenksMatrices=D,P.jenksBreaks=E,P.jenks=F,P.bayesian=c,P.epsilon=R,P.factorial=J,P.bernoulli_distribution=K,P.binomial_distribution=L,P.poisson_distribution=M,P.chi_squared_goodness_of_fit=N,P.z_score=I,P.cumulative_std_normal_probability=H,P.standard_normal_table=Q,P.average=e,P.interquartile_range=B,P.mixin=O,P.median_absolute_deviation=C,P.rms=h}(this),function(){L.labelVersion="0.2.1",L.Label=L.Class.extend({includes:L.Mixin.Events,options:{className:"",clickable:!1,direction:"right",noHide:!1,offset:[12,-15],opacity:1,zoomAnimation:!0},initialize:function(a,b){L.setOptions(this,a),this._source=b,this._animated=L.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._pane=this._source instanceof L.Marker?a._panes.markerPane:a._panes.popupPane,this._container||this._initLayout(),this._pane.appendChild(this._container),this._initInteraction(),this._update(),this.setOpacity(this.options.opacity),a.on("moveend",this._onMoveEnd,this).on("viewreset",this._onViewReset,this),this._animated&&a.on("zoomanim",this._zoomAnimation,this),L.Browser.touch&&!this.options.noHide&&L.DomEvent.on(this._container,"click",this.close,this)},onRemove:function(a){this._pane.removeChild(this._container),a.off({zoomanim:this._zoomAnimation,moveend:this._onMoveEnd,viewreset:this._onViewReset},this),this._removeInteraction(),this._map=null},setLatLng:function(a){return this._latlng=L.latLng(a),this._map&&this._updatePosition(),this},setContent:function(a){return this._previousContent=this._content,this._content=a,this._updateContent(),this},close:function(){var a=this._map;a&&(L.Browser.touch&&!this.options.noHide&&L.DomEvent.off(this._container,"click",this.close),a.removeLayer(this))},updateZIndex:function(a){this._zIndex=a,this._container&&this._zIndex&&(this._container.style.zIndex=a)},setOpacity:function(a){this.options.opacity=a,this._container&&L.DomUtil.setOpacity(this._container,a)},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-label "+this.options.className+" leaflet-zoom-animated"),this.updateZIndex(this._zIndex)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updatePosition(),this._container.style.visibility="")},_updateContent:function(){this._content&&this._map&&this._prevContent!==this._content&&"string"==typeof this._content&&(this._container.innerHTML=this._content,this._prevContent=this._content,this._labelWidth=this._container.offsetWidth)},_updatePosition:function(){var a=this._map.latLngToLayerPoint(this._latlng);this._setPosition(a)},_setPosition:function(a){var b=this._map,c=this._container,d=b.latLngToContainerPoint(b.getCenter()),e=b.layerPointToContainerPoint(a),f=this.options.direction,g=this._labelWidth,h=L.point(this.options.offset);"right"===f||"auto"===f&&e.x<d.x?(L.DomUtil.addClass(c,"leaflet-label-right"),L.DomUtil.removeClass(c,"leaflet-label-left"),a=a.add(h)):(L.DomUtil.addClass(c,"leaflet-label-left"),L.DomUtil.removeClass(c,"leaflet-label-right"),a=a.add(L.point(-h.x-g,h.y))),L.DomUtil.setPosition(c,a)},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPosition(b)},_onMoveEnd:function(){this._animated&&"auto"!==this.options.direction||this._updatePosition()},_onViewReset:function(a){a&&a.hard&&this._update()},_initInteraction:function(){if(this.options.clickable){var a=this._container,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.addClass(a,"leaflet-clickable"),L.DomEvent.on(a,"click",this._onMouseClick,this);for(var c=0;b.length>c;c++)L.DomEvent.on(a,b[c],this._fireMouseEvent,this)}},_removeInteraction:function(){if(this.options.clickable){var a=this._container,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.removeClass(a,"leaflet-clickable"),L.DomEvent.off(a,"click",this._onMouseClick,this);for(var c=0;b.length>c;c++)L.DomEvent.off(a,b[c],this._fireMouseEvent,this)}},_onMouseClick:function(a){this.hasEventListeners(a.type)&&L.DomEvent.stopPropagation(a),this.fire(a.type,{originalEvent:a})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&L.DomEvent.preventDefault(a),"mousedown"!==a.type?L.DomEvent.stopPropagation(a):L.DomEvent.preventDefault(a)}}),L.BaseMarkerMethods={showLabel:function(){return this.label&&this._map&&(this.label.setLatLng(this._latlng),this._map.showLabel(this.label)),this},hideLabel:function(){return this.label&&this.label.close(),this},setLabelNoHide:function(a){this._labelNoHide!==a&&(this._labelNoHide=a,a?(this._removeLabelRevealHandlers(),this.showLabel()):(this._addLabelRevealHandlers(),this.hideLabel()))},bindLabel:function(a,b){var c=this.options.icon?this.options.icon.options.labelAnchor:this.options.labelAnchor,d=L.point(c)||L.point(0,0);return d=d.add(L.Label.prototype.options.offset),b&&b.offset&&(d=d.add(b.offset)),b=L.Util.extend({offset:d},b),this._labelNoHide=b.noHide,this.label||(this._labelNoHide||this._addLabelRevealHandlers(),this.on("remove",this.hideLabel,this).on("move",this._moveLabel,this).on("add",this._onMarkerAdd,this),this._hasLabelHandlers=!0),this.label=new L.Label(b,this).setContent(a),this},unbindLabel:function(){return this.label&&(this.hideLabel(),this.label=null,this._hasLabelHandlers&&(this._labelNoHide||this._removeLabelRevealHandlers(),this.off("remove",this.hideLabel,this).off("move",this._moveLabel,this).off("add",this._onMarkerAdd,this)),this._hasLabelHandlers=!1),this},updateLabelContent:function(a){this.label&&this.label.setContent(a)},getLabel:function(){return this.label},_onMarkerAdd:function(){this._labelNoHide&&this.showLabel()},_addLabelRevealHandlers:function(){this.on("mouseover",this.showLabel,this).on("mouseout",this.hideLabel,this),L.Browser.touch&&this.on("click",this.showLabel,this)},_removeLabelRevealHandlers:function(){this.off("mouseover",this.showLabel,this).off("mouseout",this.hideLabel,this),L.Browser.touch&&this.off("click",this.showLabel,this)},_moveLabel:function(a){this.label.setLatLng(a.latlng)}},L.Icon.Default.mergeOptions({labelAnchor:new L.Point(9,-20)}),L.Marker.mergeOptions({icon:new L.Icon.Default}),L.Marker.include(L.BaseMarkerMethods),L.Marker.include({_originalUpdateZIndex:L.Marker.prototype._updateZIndex,_updateZIndex:function(a){var b=this._zIndex+a;this._originalUpdateZIndex(a),this.label&&this.label.updateZIndex(b)},_originalSetOpacity:L.Marker.prototype.setOpacity,setOpacity:function(a,b){this.options.labelHasSemiTransparency=b,this._originalSetOpacity(a)},_originalUpdateOpacity:L.Marker.prototype._updateOpacity,_updateOpacity:function(){var a=0===this.options.opacity?0:1;this._originalUpdateOpacity(),this.label&&this.label.setOpacity(this.options.labelHasSemiTransparency?this.options.opacity:a)},_originalSetLatLng:L.Marker.prototype.setLatLng,setLatLng:function(a){return this.label&&!this._labelNoHide&&this.hideLabel(),this._originalSetLatLng(a)}}),L.CircleMarker.mergeOptions({labelAnchor:new L.Point(0,0)}),L.CircleMarker.include(L.BaseMarkerMethods),L.Path.include({bindLabel:function(a,b){return this.label&&this.label.options===b||(this.label=new L.Label(b,this)),this.label.setContent(a),this._showLabelAdded||(this.on("mouseover",this._showLabel,this).on("mousemove",this._moveLabel,this).on("mouseout remove",this._hideLabel,this),L.Browser.touch&&this.on("click",this._showLabel,this),this._showLabelAdded=!0),this},unbindLabel:function(){return this.label&&(this._hideLabel(),this.label=null,this._showLabelAdded=!1,this.off("mouseover",this._showLabel,this).off("mousemove",this._moveLabel,this).off("mouseout remove",this._hideLabel,this)),this},updateLabelContent:function(a){this.label&&this.label.setContent(a)},_showLabel:function(a){this.label.setLatLng(a.latlng),this._map.showLabel(this.label)},_moveLabel:function(a){this.label.setLatLng(a.latlng)},_hideLabel:function(){this.label.close()}}),L.Map.include({showLabel:function(a){return this.addLayer(a)}}),L.FeatureGroup.include({clearLayers:function(){return this.unbindLabel(),this.eachLayer(this.removeLayer,this),this},bindLabel:function(a,b){return this.invoke("bindLabel",a,b)},unbindLabel:function(){return this.invoke("unbindLabel")},updateLabelContent:function(a){this.invoke("updateLabelContent",a)}})}(this,document);var Legende=L.Control.extend({options:{position:"bottomleft"},initialize:function(a){L.Util.setOptions(this,a)},reverseArr:function(a){for(var b=new Array,c=a.length-1;c>=0;c--)b.push(a[c]);return b},onAdd:function(a){jQuery("div.legend").remove();var b=L.DomUtil.create("div","legend"),c=this.options.couleurs.palette,d=this.options.couleurs.grades,e=c.slice(-d.length),f=new Array;i=0,src="",src2="";var g=this.options.couleurs.densiteh,h=" - ",i=d.length-1;if(d.length<5)if(g){var j=0;for(i;i>=0;i--,j++)src='<span style="background:'+e[j]+'"></span>',src2="<label>"+format(d[i])+"</label>",f.push({label:src2,couleur:src})}else for(i;i>=0;i--)src='<span style="background:'+e[i]+'"></span>',src2="<label>"+format(d[i])+"</label>",f.push({label:src2,couleur:src});else if(g){var j=0;for(i;i>0;i--,j++)d[i-1]==d[i]||d[i-1]==d[i]-1&&i!=d.length-1?src2="<label>"+format(d[i-1])+"</label>":i==d.length-1?src2="<label>"+format(d[i-1])+" - "+format(d[i])+"</label>":src2="<label>"+format(d[i-1])+" - "+format(d[i]-1)+"</label>",src='<span style="background:'+e[j]+'"></span>',f.push({label:src2,couleur:src})}else for(i;i>0;i--){var k="";k=d[i-1]==d[i]||d[i-1]==d[i]-1?format(d[i-1]):i==d.length-1?format(d[i-1])+h+format(d[i]):format(d[i-1])+h+format(d[i]-1),src='<span style="background:'+e[i-1]+'"></span>',src2="<label>"+k+"</label>",f.push({label:src2,couleur:src})}var l="",m="";return f.reverse().forEach(function(a){l+=a.label,m+=a.couleur}),b.innerHTML+=l+"<br/>"+m,b}}),Grades=function(){function a(a,c){for(var d=jQuery.map(a.features,function(a){return a.properties.resultat._valeur}),e=0,f=[];void 0!=a.features[e];)jQuery.inArray(a.features[e].properties.resultat._valeur,f)==-1&&f.push(a.features[e].properties.resultat._valeur),e++;if(f=b(f),f.length>5)if(c){for(var g=Math.round(f.length/4),h=[f[0]],i=g-1;void 0!=f[i];)h.push(f[i]),i+=g;5!=h.length&&h.push(f[f.length-1]),h[h.length-1]!=f[f.length-1]&&(h[h.length-1]=f[f.length-1]),f=h}else{f=ss.jenks(d,4);for(var j=0;j<4;j++)f[j]==f[j+1]&&f[j+1]++}this.grades=f}var b=function(a){return a.sort(function(a,b){return a-b})};return a}(),Couleur=function(){function a(a,b){this.densiteh="Habitants pour 1 établissement"==a.statistique.resultat[0]._nom;var d=$.map(a.features,function(a){if("IMPOSSIBLE"!=a.properties.resultat._valeur)return a}),e={features:d},f=new Grades(e,this.densiteh);this.grades=f.grades,this.palette=c(b),this.npalette=this.palette.slice(-this.grades.length)}var b={coldefault:["#B2DFDB","#4DB6AC"," #00897B","#004D40"],Alimentation:["#bbdefb","#64b5f6","#1e88e5","#0d47a1"],Batiment:["#ffe0b2","#ffb74d","#ff9800","#ef6c00"],Fabrication:["#ffccbc","#ff7043","#e64a19","#bf360c"],Services:["#c8e6c9","#66bb6a","#388e3c","#1b5e20"],secteur:"coldefault"},c=function(a){switch(a){case"Alimentation":var c=b.Alimentation;break;case"Bâtiment":var c=b.Batiment;break;case"Fabrication":var c=b.Fabrication;break;case"Services":var c=b.Services;break;default:var c=b.coldefault}return c};return a.prototype.getcol=function(a){if("IMPOSSIBLE"==a)return"#dedede";var b=0;if(b=this.grades.length<5?this.grades.length-1:this.grades.length-2,this.densiteh){for(var c=0;!(a>=this.grades[b]);)c++,b--;return this.npalette[c]}for(;!(a>=this.grades[b]);)b--;return this.npalette[b]},a}();!function(a){a.geometiers=function(b,c){var d={accessToken:"pk.eyJ1IjoiYXJ0ODIiLCJhIjoic3hwSDFJRSJ9.D82gjhYrYR935Knj8cNVwg",mapLogin:"art82.5d30wpk0",urlstyle:"cixlnex77000s2sntu1jcfn6o",lat:"44.01667",lng:"1.35",opacity:1,displayTiles:!1,zoom:8,maxZoom:14,filtres:new Array,arttruefalse:!1,colorLayerContour:"#ffffff",colorLayerContourOver:"#ffffff",colorLayerBackground:"#1a1a1a",colorContourArtisan:"#FFC107",zoomLimitDisplayPopup:10,zoneSelect:{name:"departement",value:"1"},decoupage:{name:"decoupage",value:"arrondissement"},initParent:null,update:null,updateMap:null,changeDatas:null,find:null,selectDecoupage:null,selectBreadcrumb:null,selectZone:null,navigationControl:!1,decoupeControl:!1,legendeDisplay:!1},e=this;e.settings={};var f,g=a(b),b=b,h=null,i=new Array,j=new Array,k=new Array,l=new L.FeatureGroup;e.init=function(){e.settings=a.extend({},d,c),console.log("geometiers plugin init !"),e.settings.decoupageInit=e.settings.decoupage,e.settings.decoupage={name:"decoupage",value:e.settings.decoupage},f=new L.Map(g.attr("id"),{zoomControl:!1,minZoom:e.settings.zoom,maxZoom:e.settings.maxZoom,attributionControl:!1,dragging:!0,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!0,tap:!0})},e.parent=function(a){geojson=L.geoJson(a,{style:function(a){return{fillColor:e.settings.colorLayerBackground,weight:0,opacity:0,color:"#000000",fillOpacity:1}}}),l.clearLayers(),l.addLayer(geojson),l.addTo(f);var b=l.getBounds().getCenter();f.setView([b.lat,b.lng],e.settings.zoom),f.setMaxBounds(f.getBounds());var a=e.datas();e.settings.initParent&&e.settings.initParent(a)},e.isDensiteh=function(){return void 0!=e.getDatasItem("stats")&&"densiteh"==e.getDatasItem("stats").value},e.datas=function(){return a.unique(e.settings.filtres.concat(e.settings.zoneSelect,e.settings.decoupage))},e.getDatasItem=function(a){var b=e.datas(),c=b.filter(function(b){return b.name===a});return void 0!=c&&c[0]},e.setFiltres=function(a){a&&(e.settings.filtres=a)},e.rechercher=function(a,b){v(),f.setView([e.settings.lat,e.settings.lng],e.settings.zoom),e.settings.decoupage={name:"decoupage",value:"commune"},geojson=L.geoJson(a,{style:{weight:1,opacity:1,color:e.settings.colorLayerContour,fillOpacity:1,fillColor:"#31313b"},onEachFeature:m}).addTo(f),i.push(geojson);var c=w(b.value,b.name);null!=c&&setTimeout(function(){c.on("click",r),c.fireEvent("click")},500)},e.dessiner=function(a,b){if(void 0!=b&&null!=b){A(b),b.off("mouseout",q),b.off("mouseover",p),b.off("click",r);var c=t(b);j[c]=b,u(b),z(),b.setStyle({weight:3,fillOpacity:0,color:e.settings.colorLayerContourOver}),f.fitBounds(b.getBounds(),{maxZoom:11}),e.settings.navigationControl&&B(b)}else void 0!=i[i.length-1]&&(i[i.length-1].clearLayers(),i.pop());if(void 0!=e.getDatasItem("secteur")){var d=e.getDatasItem("secteur");h=new Couleur(a,d.value)}else h=new Couleur(a);geojson=L.geoJson(a,{style:n});var g=geojson.getLayers().length,k=L.featureGroup();k.addTo(f),i.push(k),o(0,g),e.settings.update&&e.settings.update(a.statistique),e.settings.decoupeControl&&C(),e.settings.legendeDisplay&&(legende=new Legende({couleurs:h}),legende.addTo(f))};var m=function(a,b){L.Browser.touch&&L.Browser.mobile?b.on({mouseover:p,mouseout:q,click:r}):b.on({mouseover:p,mouseout:q,click:r}).bindLabel("geo",{className:"labelZone",direction:"auto",offset:[50,-10]})},n=function(a){return{weight:1,opacity:1,color:e.settings.colorLayerContour,fillOpacity:1,fillColor:h.getcol(a.properties.resultat._valeur)}},o=function(a,b){setTimeout(function(){void 0!=geojson.getLayers()[a]&&i[i.length-1].addLayer(geojson.getLayers()[a]),a++,a<b?o(a,b):(i[i.length-1].eachLayer(function(a){m(void 0,a)}),e.settings.updateMap&&e.settings.updateMap())},5)},p=function(b){var c=b.target;x(c)?c.setStyle({weight:3,opacity:1,color:e.settings.colorLayerContourOver}):c.setStyle({fillColor:"#25252c",weight:1,opacity:1,fillOpacity:1}),L.Browser.ie||L.Browser.opera||c.bringToFront(),a(".leaflet-label.labelZone").html(s(c))},q=function(a){var b=a.target;x(b)?b.setStyle({weight:1,opacity:1,color:e.settings.colorLayerContour}):b.setStyle({fillColor:e.settings.colorLayerBackground,weight:1,opacity:1,color:e.settings.colorLayerContour,fillOpacity:1})},r=function(a){var b=a.target;if(y(b)){var c=e.datas();e.settings.selectZone&&e.settings.selectZone(c,null)}else{e.settings.zoneSelect={name:b.feature.properties.type,value:b.feature.properties.code},e.settings.arttruefalse=!1,"departement"==b.feature.properties.type?e.settings.decoupage={name:"decoupage",value:"pays"}:"pays"==b.feature.properties.type?e.settings.decoupage={name:"decoupage",value:"epci"}:"epci"!=b.feature.properties.type&&"canton"!=b.feature.properties.type&&"arrondissement"!=b.feature.properties.type||(e.settings.decoupage={name:"decoupage",value:"commune"});var c=e.datas();e.settings.selectZone&&e.settings.selectZone(c,b)}},s=function(a){var b="",b="<h4>"+a.feature.properties.typeDeTerritoire+"</h4><h1>"+a.feature.properties.nom+"</h1>";if(x(a)){b+="IMPOSSIBLE"==a.feature.properties.resultat._valeur?"<span class='error'>Pas d'établissement</span>":'<span class="nbrFiltrer">'+number_format(a.feature.properties.resultat._valeur,0," "," ")+"</span> "+a.feature.properties.resultat._type,b+='<p class="filtresListes">'+a.feature.properties.resultat._nom+"<br/>";for(var c in a.feature.properties.resultat._filtres)b+=a.feature.properties.resultat._filtres[c]._nom+"<br/>";b+="</p>"}return b},t=function(a){for(var b=0,c=!1;0==c&&b<i.length;)i[b].hasLayer(a)?c=!0:b++;return b},u=function(a){for(var b=t(a),c=i.slice(b+1),d=0;d<c.length;)i.pop(c[d]),c[d].clearLayers(),d++},v=function(){for(var a=0;a<i.length;)i[a].clearLayers(),a++;i=new Array,j=new Array},w=function(a,b){for(var c=null,d=0;d<i.length;d++)i[d].eachLayer(function(d){d.feature.properties.type==b&&d.feature.properties.code==a&&(c=d)});return null!=c&&e.settings.find&&e.settings.find(c),c},x=function(a){return void 0!=a&&a.feature.properties.parent.type==e.settings.zoneSelect.name&&a.feature.properties.parent.code==e.settings.zoneSelect.value},y=function(a){return void 0!=a&&a.feature.properties.type==e.settings.zoneSelect.name&&a.feature.properties.code==e.settings.zoneSelect.value},z=function(){for(var a=0;a<i.length;a++)i[a].eachLayer(function(a){a.setStyle({fillColor:e.settings.colorLayerBackground,weight:1,opacity:1,color:e.settings.colorLayerContour,fillOpacity:1})})},A=function(a){for(var a,b=t(a),c=j.slice(b),d=0;d<c.length;)a=c[d],a.setStyle({fillColor:e.settings.colorLayerBackground,weight:1,opacity:1,color:e.settings.colorLayerContour,fillOpacity:.5}),a.on("mouseout",q),a.on("mouseover",p),a.on("click",r),d++},B=function(b){a("#jq-dropdown-navigation").empty();var c=a('<button id="btn-navigation" class="mdl-button mdl-js-button mdl-button--icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons">&#xE5C4;</i></button>'),d=a("<ul />").addClass("dropdown-menu"),g=t(b);k.splice(g+1,k.length);var h=a("<li/>").addClass("mdl-menu__item").attr("data-type",b.feature.properties.parent.type).attr("data-code",b.feature.properties.parent.code).text(b.feature.properties.parent.nom);
k[g]=h;for(var g=k.length-1;g>=0;g--)k[g].appendTo(d);c.appendTo(a("#jq-dropdown-navigation")),d.appendTo(a("#jq-dropdown-navigation")),componentHandler.upgradeElement(c.get(0)),componentHandler.upgradeElement(d.get(0)),a("#jq-dropdown-navigation li").on("click",function(b){var c=w(a(this).data("code"),a(this).data("type"));if(null!=c)c.on("click",r),c.fireEvent("click");else{v(),f.setView([e.settings.lat,e.settings.lng],e.settings.zoom),a("#jq-dropdown-navigation").empty(),e.settings.zoneSelect={name:a(this).data("type"),value:a(this).data("code")},e.settings.decoupage={name:"decoupage",value:e.settings.decoupageInit};var d=e.datas();e.settings.selectBreadcrumb&&e.settings.selectBreadcrumb(d)}})},C=function(){a("#jq-dropdown-decoupe").empty();var b=a('<button id="btn-decoupage" class="mdl-button mdl-js-button mdl-button--icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons">&#xE14E;</i></button>'),c=a("<ul />").addClass("dropdown-menu "+e.settings.decoupeControl.class);"departement"==e.settings.zoneSelect.name?(b.appendTo(a("#jq-dropdown-decoupe")),c.appendTo(a("#jq-dropdown-decoupe")),a("<li/>").addClass("mdl-menu__item").attr("data-type","arrondissement").text("Arrondissements").appendTo(c),a("<li/>").addClass("mdl-menu__item").attr("data-type","pays").text("Pôles d'Equilibre Territorial et Rural").appendTo(c),a("<li/>").addClass("mdl-menu__item").attr("data-type","canton").text("Cantons").appendTo(c),a("<li/>").addClass("mdl-menu__item").attr("data-type","epci").text("Intercommunalités").appendTo(c),a("<li/>").addClass("mdl-menu__item").attr("data-type","commune").text("Communes").appendTo(c),a("#jq-dropdown-decoupe li[data-type='"+e.settings.decoupage.value+"']").length>0?a("#jq-dropdown-decoupe li[data-type='"+e.settings.decoupage.value+"']").addClass("selected"):a("#jq-dropdown-decoupe li[data-type='pays']").addClass("selected"),componentHandler.upgradeElement(b.get(0)),componentHandler.upgradeElement(c.get(0))):"pays"==e.settings.zoneSelect.name&&(b.appendTo(a("#jq-dropdown-decoupe")),c.appendTo(a("#jq-dropdown-decoupe")),a("<li/>").addClass("mdl-menu__item").attr("data-type","epci").text("Intercommunalités").appendTo(c),a("<li/>").addClass("mdl-menu__item").attr("data-type","commune").text("Communes").appendTo(c),a("#jq-dropdown-decoupe li[data-type='"+e.settings.decoupage.value+"']").length>0?a("#jq-dropdown-decoupe li[data-type='"+e.settings.decoupage.value+"']").addClass("selected"):a("#jq-dropdown-decoupe li[data-type='epci']").addClass("selected"),componentHandler.upgradeElement(b.get(0)),componentHandler.upgradeElement(c.get(0))),a("#jq-dropdown-decoupe li").on("click",function(b){e.settings.decoupage={name:"decoupage",value:a(this).data("type")};var c=e.datas();e.settings.selectDecoupage&&e.settings.selectDecoupage(c)})};e.init()},a.fn.geometiers=function(b){return this.each(function(){if(void 0==a(this).data("geometiers")){var c=new a.geometiers(this,b);a(this).data("geometiers",c)}})}}(jQuery);